{% extends "base.html" %}

{% block extracss %}
<style>
#sunburst {
    display: inline;
}

.plot-container {
    filter: invert(75%) hue-rotate(180deg);
}

.example {
    max-height: 40vh;
}

canvas {
    display: block;
}

canvas.scale {
    height: calc(100vh - 56px);
}

canvas.main {
    width: calc(100vh - 56px);
    height: calc(100vh - 56px);
}
</style>
{% endblock extracss %}

{% block extranavbarend %}
<div class="navbar-item">
    <div class="buttons">
        <a class="button is-white js-modal-trigger" data-target="options-modal">
            <strong>Options</strong>
        </a>
    </div>
</div>
{% endblock extranavbarend %}

{% block content %}
<section class="section p-0 m-0">
    <div class="columns m-0 p-0">
        <div class="column is-7 m-0 p-0">
            <div id="sunburst"></div>
        </div>
        <div class="column is-5 m-0 p-0">
            <div class="content my-5" id="info"></div>
            <div>
                <h3 id="example-title" class="title is-3" style="display: none;">Exemple</h3>
                <button id="loading-animation" class="button is-loading is-ghost" style="display: none"></button>
                <div id="example"></div>
                <article id="error" class="message is-danger" style="display: none;">
                    <div class="message-header">
                        <p>Erreur</p>
                    </div>
                    <div class="message-body">
                        Impossible de charger l'image.
                    </div>
                </article>
            </div>
        </div>
    </div>
</section>

<div id="options-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
        <article class="message">
            <div class="message-header">
                <p>Options</p>
                <button class="delete close-button" aria-label="delete"></button>
            </div>
            <div class="message-body content">
                <div id="controls"></div>
                <div class="has-text-centered">
                    <button class="button is-link mt-6 close-button">
                        Valider
                    </button>
                </div>
            </div>
        </article>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>
{% endblock content %}

{% block extrajs %}
<script src="/static/plot.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Functions to open and close a modal
        function openModal($el) {
            $el.classList.add('is-active');
        }

        function closeModal($el) {
            $el.classList.remove('is-active');
        }

        function closeAllModals() {
            (document.querySelectorAll('.modal') || []).forEach(($modal) => {
                closeModal($modal);
            });
        }

        // Add a click event on buttons to open a specific modal
        (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
            const modal = $trigger.dataset.target;
            const $target = document.getElementById(modal);

            $trigger.addEventListener('click', () => {
                openModal($target);
            });
        });

        // Add a click event on various child elements to close the parent modal
        (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
            const $target = $close.closest('.modal');

            $close.addEventListener('click', () => {
                closeModal($target);
            });
        });

        (document.querySelectorAll('.close-button') || []).forEach(($close) => {
            $close.addEventListener('click', () => {
                closeAllModals();
            });
        });

        // Add a keyboard event to close all modals
        document.addEventListener('keydown', (event) => {
            if(event.key === "Escape") {
                closeAllModals();
            }
        });
    });

    (async function() {
        const Plot = await initPlot();
        Plot.main();
    })();
</script>
{% endblock extrajs %}
